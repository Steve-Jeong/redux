<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.5/redux.js"></script>
</head>
<body>
    <div id="subject"></div>
    <div id="TOC"></div>
    <div id="control"></div>
    <div id="article"></div>

    <script>
        function subject() {
            document.querySelector('#subject').innerHTML = `
                <header>
                    <h1>WEB</h1>
                    Hello, WEB!
                </header>
            `
        }

        function TOC() {
            var state = store.getState()
            console.log(state)
            var list = '';
            for(let id in state.contents) {
                list += `<li>
                    <a onclick="
                        event.preventDefault()
                        var action = {type:'SELECT', id:${state.contents[id].id}}
                        store.dispatch(action)

                    "
                    href=${state.contents[id].id}>
                        ${state.contents[id].title}
                    </a>
                </li>`
            }
            document.querySelector('#TOC').innerHTML = `
                <nav>
                    <ol>
                        ${list}
                    </ol>
                </nav>
            `
        }

        function control() {
            document.querySelector('#control').innerHTML = `
                <ul>
                    <li><a href="/create">Create</a></li>
                    <li><input type="button" value="Delete"></input></li>
                </ul>
            `
        }

        function article() {
            var state = store.getState()
            let _title = ''
            let _desc = ''
            let i=0
            while(i<state.contents.length) {
                if(state.selected_id === state.contents[i].id) {
                    _title = state.contents[i].title
                    _desc = state.contents[i].desc
                    break
                }
                i++
            }
            document.querySelector('#article').innerHTML = `
                <article>
                    <h2>${_title}</h2>
                    ${_desc}
                </article>
            `
        }

        function reducer(state, action) {
            if(state===undefined) {
                return {
                    selected_id : 1,
                    contents:[
                        {id:1, title:'HTML', desc:'HTML is ...'},
                        {id:2, title:'CSS', desc:'CSS is ...'},
                    ]
                }
            }

            var newState = null
            if(action.type === "SELECT") {
                newState = Object.assign({}, state, {selected_id:action.id})
            }
            console.log(action, state, newState)
            return newState
        }

        var store = Redux.createStore(reducer)

        store.subscribe(article)
        subject()
        TOC()
        control()
        article()

    </script>


</body>
</html>